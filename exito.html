<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>¡Todo listo! | Martín Cullari</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="./css/style.css">
    <style>
        /* Estados de carga y UI */
        #success-ui,
        #error-ui,
        #instragram-notice {
            display: none;
        }

        /* Estilo específico para el aviso de Instagram (estilo Marton) */
        .highlight-notice {
            background: rgba(255, 205, 1, 0.08);
            padding: 1.25rem;
            border: 1px dashed var(--yellow-color);
            /* margin-top: 0.5rem; */
            max-width: 400px;
            animation: fadeIn 0.5s ease;
        }

        .highlight-notice p {
            font-family: 'Outfit';
            font-size: 1rem;
            color: var(--white-color);
            line-height: 2;
            /* margin: 0; */
            text-align: center;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="layout-exito">

    <main class="exito">
        <div class="exito__container container">

            <div id="success-ui">
                <div class="exito__header">
                    <div class="exito__icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#010101" stroke-width="3"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 6L9 17l-5-5" />
                        </svg>
                    </div>
                    <h1 class="exito__title">¡PAGO COMPLETADO!</h1>
                    <p class="exito__subtitle">Tu mejor versión arranca hoy.</p>
                </div>

                <div class="exito__download-card">
                    <a href="#" id="download-btn" class="exito__download-btn">DESCARGAR AHORA</a>
                </div>
            </div>

            <div id="error-ui">
                <div class="exito__header">
                    <h1 class="exito__title" style="color: #ff4444;">UPS! ALGO FALLÓ</h1>
                    <p class="exito__subtitle">No pudimos validar tu enlace.</p>
                </div>
            </div>

            <div id="app-notice" class="highlight-notice">
                <p>
                    Si la descarga no inicia, tocá arriba en los <strong>tres puntitos</strong>
                    <img src="assets/icons/ellipsis-vertical.svg" alt="" class="icon-inline">
                    y seleccioná
                </p>
                <p>
                    <img src="assets/icons/square-arrow-out-up-right.svg" alt="" class="icon-inline">
                    <strong>"Abrir en navegador externo".</strong>
                </p>
            </div>

            <div class="exito__actions">
                <a href="https://wa.me/5491162304028?text=%C2%A1Hola%20Marton!%20Tuve%20un%20problema%20con%20la%20descarga%20directa%20de%20mi%20plan.%20%C2%BFMe%20podr%C3%ADas%20ayudar%3F"
                    class="exito__btn-help" target="_blank" rel="noopener noreferrer">
                    ¿PROBLEMAS CON LA DESCARGA? ESCRIBIME ACÁ
                </a>
                <a href="index.html" class="exito__btn-back"
                    style="display: block; margin-top: 1rem; opacity: 0.6; text-decoration: none; font-family: 'Outfit'; font-size: 0.8rem;">←
                    VOLVER AL INICIO</a>
            </div>

        </div>
    </main>

    <footer class="footer">
        <div class="footer__container container">
            <p class="footer__text">&copy; 2025 Martín Cullari</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const fileId = params.get('id');

            const successUI = document.getElementById('success-ui');
            const errorUI = document.getElementById('error-ui');
            const downloadBtn = document.getElementById('download-btn');
            const appNotice = document.getElementById('app-notice'); // El nuevo ID genérico

            // Detectores
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            // Detecta casi cualquier navegador integrado de RRSS
            const isInApp = /Instagram|FBAN|FBAV|Discord|Twitter|Threads|Line/i.test(navigator.userAgent);

            if (fileId && fileId.length > 15) {
                downloadBtn.href = `https://drive.google.com/uc?export=download&id=${fileId}`;
                successUI.style.display = 'block';

                // Forzamos target blank para iOS y Apps para mejorar compatibilidad
                if (isIOS || isInApp) {
                    downloadBtn.setAttribute('target', '_blank');
                }

                // Si detectamos que NO es un navegador real (Chrome/Safari), mostramos el aviso
                if (isInApp) {
                    appNotice.style.display = 'block';
                }
            } else {
                errorUI.style.display = 'block';
            }
        });
    </script>
</body>

</html>